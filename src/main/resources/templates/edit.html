<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<header>
    <p class="displayed"><img th:src="@{/img/logo.svg}" alt="University Logo" class="logo"></p>
</header>

<main>
    <!--<h2>–ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</h2>-->
    <form th:action="@{/api/search}" th:method="get">
        <section class="search-section">
            <!--<label for="roomNumber">–ù–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏:</label>-->
            <input class="search-box" type="text" name="roomNumber" id="roomNumber" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏" required>

            <div class="room-list">
                    <!--<label for="buildingId">–ö–æ—Ä–ø—É—Å:</label>-->
                    <select class="room-button" style="height: 40px;" name="buildingId" id="buildingId">
                        <option value="1" id="1">–ú–µ—Ö</option>
                        <option value="2" id="2">–ì–∏–¥—Ä–æ</option>
                        <option value="3" id="3">–ì–ª–∞–≤–Ω—ã–π</option>
                        <option value="4" id="4">–ó–æ–æ</option>
                        <option value="5" id="5">–≠–ª–µ–∫—Ç—Ä–æ</option>
                        <option value="6" id="6">–ó–†</option>
                        <option value="7" id="7">–≠–∫–æ–Ω–æ–º</option>
                        <option value="8" id="8">–í–ú</option>
                    </select>
            </div>

            <button id="search-button" type="submit">üîç</button>
        </section>
    </form>

    <section class="room-info">
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</h2>

        <form th:action="@{/api/edit}" method="post">
            <button type="button" id="add-device-button" class="add-button">–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
            <input type="hidden" name="buildingId" th:value="${buildingId}">
            <input type="hidden" name="roomNumber" th:value="${roomNumber}">
            <div th:each="dev : ${devicesList}">
                <input type="hidden" name="auditoriesId" th:value="${dev.auditoriesId}">
            </div>
            <div id="devices-container">
                <div class="info-section" th:each="device, iterStat : ${devicesList}">
                    <table class="device">
                        <tr>
                            <td>
                                <input type="hidden" name="deviceListId" th:value="${device.id}">
                                <select class="select-height" name="deviceId" required>
                                    <option th:each="availableDevice : ${allDevices}"
                                            th:value="${availableDevice.id}"
                                            th:text="${availableDevice.name}"
                                            th:selected="${device.deviceId == availableDevice.id}"></option>
                                </select>
                            </td>
                            <td>
                                <select name="availability">
                                    <option value="true" th:selected="${device.availability}">–î–∞</option>
                                    <option value="false" th:selected="${!device.availability}">–ù–µ—Ç</option>
                                </select>
                            </td>
                        </tr>
                    </table>

                    <textarea name="text" rows="3" th:text="${device.text}"></textarea>
                    <button type="button" class="delete-button">–£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
                </div>
            </div>
            <button type="submit" class="refresh-button">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </section>
</main>
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
        const addDeviceButton = document.getElementById("add-device-button");
        const devicesContainer = document.getElementById("devices-container");

        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (addDeviceButton && devicesContainer) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º allDevices, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏ –≤ –æ–±—ä–µ–∫—Ç JavaScript
            var allDevices = /*[[${allDevices}]]*/ [];

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            addDeviceButton.addEventListener("click", function () {
                const newDeviceHtml = `
                    <div class="info-section">
                        <table class="device">
                            <tr>
                                <td>
                                    <input type="hidden" name="deviceListId" value="">
                                    <select class="select-height" name="deviceId" required>
                                        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</option>
                                        ${allDevices.map(device => `<option value="${device.id}">${device.name}</option>`).join('')}
                                    </select>
                                </td>
                                <td>
                                    <select name="availability">
                                        <option value="true">–î–∞</option>
                                        <option value="false">–ù–µ—Ç</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                        <textarea name="text" rows="3"></textarea>
                        <button type="button" class="delete-button">–£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
                    </div>
                `;

                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                const tempDiv = document.createElement("div");
                tempDiv.innerHTML = newDeviceHtml;

                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                devicesContainer.appendChild(tempDiv.firstElementChild);

                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
                const deleteButton = tempDiv.querySelector(".delete-button");
                deleteButton.addEventListener("click", function () {
                    tempDiv.remove(); // –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            devicesContainer.addEventListener("click", function (event) {
                if (event.target.classList.contains("delete-button")) {
                    const deviceSection = event.target.closest(".info-section");
                    deviceSection.remove(); // –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                }
            });
        } else {
            console.error("–ö–Ω–æ–ø–∫–∞ '–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ' –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
        }
    });
</script>
</body>
</html>
